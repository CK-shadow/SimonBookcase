---
title: 阿里巴巴 Java 开发手册
date: 2022-11-28 23:41:02
tags: JAVA
categories: 
  - JAVA
top_img: https://simon-bookcase.oss-cn-beijing.aliyuncs.com/JAVA/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%20Java%20%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C/pexels-kushal-kumar-13079565.jpg
cover: https://simon-bookcase.oss-cn-beijing.aliyuncs.com/JAVA/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%20Java%20%E5%BC%80%E5%8F%91%E6%89%8B%E5%86%8C/pexels-kushal-kumar-13079565.jpg
---
# 阿里巴巴 Java 开发手册

## 编程规约

### 命名风格



1. 类名使用 UpperCamelCase 风格，但以下情形例外：DO / BO / DTO / VO / AO / PO / UID 等
2. 常量命名全部大写，单词间用下划线隔开，力求语义表达完整清楚，不要嫌名字长
3. 抽象类命名使用 Abstract 或 Base 开头；异常类命名使用 Exception 结尾；测试类 命名以它要测试的类的名称开始，以 Test 结尾
4. POJO 类中的任何布尔类型的变量，都不要加 is 前缀，否则部分框架解析会引起序列化错误
5. 避免在子父类的成员变量之间、或者不同代码块的局部变量之间采用完全相同的命名， 使可理解性降低
6. 接口类中的方法和属性不要加任何修饰符号（public 也不要加），保持代码的简洁性，并加上有效的 Javadoc 注释。尽量不要在接口里定义变量，如果一定要定义变量，确定 与接口方法相关，并且是整个应用的基础常量
7. 各层命名规约
   * 数据对象：xxxDO，xxx 即为数据表名
   * 数据传输对象：xxxDTO，xxx 为业务领域相关的名称
   * 展示对象：xxxVO，xxx 一般为网页名称
   * POJO 是 DO/DTO/BO/VO的统称，禁止命名成 xxxPOJO



------

### 代码格式



1. 左小括号和右边相邻字符之间不出现空格；右小括号和左边相邻字符之间也不出现空 格；而左大括号前需要加空格
2. if/for/while/switch/do 等保留字与括号之间都必须加空格
3. 任何二目、三目运算符的左右两边都需要加一个空格
4. 注释的双斜线与注释内容之间有且仅有一个空格
5. 在进行类型强制转换时，右括号与强制转换值之间不需要任何空格隔开
6. 单行字符数限制不超过 120 个，超出需要换行，换行时遵循如下原则：
   * 第二行相对第一行缩进 4 个空格，从第三行开始，不再继续缩进
   * 运算符与下文一起换行
   * 方法调用的点符号与下文一起换行
   * 方法调用中的多个参数需要换行时，在逗号后进行
   * 在括号前不要换行
7. 不同逻辑、不同语义、不同业务的代码之间插入一个空行分隔开来以提升可读性



------

### OOP 规约



1. 避免通过一个类的对象引用访问此类的静态变量或静态方法，无谓增加编译器解析成本，直接用类名来访问即可
2. 任何货币金额，均以最小货币单位且整型类型来进行存储
3. BigDecimal 的等值比较应使用 compareTo() 方法，而不是 equals() 方法
4. 禁止使用构造方法 BigDecimal(double) 的方式把 double 值转化为 BigDecimal 对象
5. 构造方法里面禁止加入任何业务逻辑，如果有初始化逻辑，请放在 init 方法中
6. 类内方法定义的顺序依次是：公有方法或保护方法 > 私有方法 > getter / setter 方法



------

### 日期时间



1. 日期格式化时，传入 pattern 中表示年份统一使用小写的 y
2. 不允许在程序任何地方中使用：1）java.sql.Date。 2）java.sql.Time。 3）java.sql.Timestamp
3. 使用枚举值来指代月份。如果使用数字，注意Date，Calendar 等日期相关类的月份 month 取值在 0-11 之间



------

### 集合处理



1. 判断所有集合内部的元素是否为空，使用 isEmpty() 方法，而不是 size()==0 的方式
2. 在使用 java.util.stream.Collectors 类的 toMap() 方法转为Map 集合时，一定要使 用含有参数类型为 BinaryOperator，参数名为mergeFunction 的方法，否则当出现相同 key 值时会抛出 IllegalStateException 异常
3. ArrayList 的 subList 结果不可强转成 ArrayList，否则会抛出 ClassCastException 异常
4. 在使用 Collection 接口任何实现类的 addAll() 方法时，都要对输入的集合参数进行 NPE 判断
5. 集合初始化时，指定集合初始值大小
6. 利用 Set 元素唯一的特性，可以快速对一个集合进行去重操作，避免使用 List 的 contains() 进行遍历去重或者判断包含操作



------

### 并发处理



1. 创建线程或线程池时请指定有意义的线程名称，方便出错时回溯
2. 线程资源必须通过线程池提供，不允许在应用中自行显式创建线程
3. 线程池不允许使用 Executors 去创建，而是通过 ThreadPoolExecutor 的方式，这样的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险
4. 必须回收自定义的 ThreadLocal 变量，尤其在线程池场景下，线程经常会被复用， 如果不清理自定义的 ThreadLocal 变量，可能会影响后续业务逻辑和造成内存泄露等问题。 尽量在代理中使用 try-finally 块进行回收
5. 对多个资源、数据库表、对象同时加锁时，需要保持一致的加锁顺序，否则可能会造成死锁
6. 并发修改同一记录时，避免更新丢失，需要加锁。要么在应用层加锁，要么在缓存加锁，要么在数据库层使用乐观锁，使用 version 作为更新依据
7. 资金相关的金融敏感信息，使用悲观锁策略
8. 使用 CountDownLatch 进行异步转同步操作，每个线程退出前必须调用 countDown 方 法，线程执行代码注意 catch 异常，确保 countDown 方法被执行到，避免主线程无法执行至 await 方法，直到超时才返回结果
9. volatile 解决多线程内存不可见问题。对于一写多读，是可以解决变量同步问题，但 是如果多写，同样无法解决线程安全问题



------

### 控制语句



1. 当 switch 括号内的变量类型为 String 并且此变量为外部参数时，必须先进行 null 判断
2. 在高并发场景中，避免使用”等于”判断作为中断或退出的条件
3. 当某个方法的代码总行数超过 10 行时，return / throw 等中断逻辑的右大括号后均 需要加一个空行



------

### 注释规约



1. 与其“半吊子”英文来注释，不如用中文注释把问题说清楚。专有名词与关键字保持英文原文即可
2. 代码修改的同时，注释也要进行相应的修改，尤其是参数、返回值、异常、核心逻辑等的修改
3. 谨慎注释掉代码。在上方详细说明，而不是简单地注释掉。如果无用，则删除



------

### 前后端规约



1. 服务端发生错误时，返回给前端的响应信息必须包含 HTTP 状态码，errorCode、 errorMessage、用户提示信息四个部分
2. 对于需要使用超大整数的场景，服务端一律使用 String 字符串类型返回，禁止使用 Long 类型
3. HTTP 请求通过URL 传递参数时，不能超过 2048 字节
4. 在翻页场景中，用户输入参数的小于 1，则前端返回第一页参数给后端；后端发现用 户输入的参数大于总页数，直接返回最后一页
5. 前后端的时间格式统一为"yyyy-MM-dd HH:mm:ss"，统一为 GMT



------

### 其它



1. 在使用正则表达式时，利用好其预编译功能，可以有效加快正则匹配速度
2. 意 Math.random() 这个方法返回是 double 类型，注意取值的范围 0≤x<1（能够 取到零值，注意除零异常），如果想获取整数类型的随机数，不要将 x 放大 10 的若干倍然后 取整，直接使用 Random对象的 nextInt 或者 nextLong 方法



------

## 异常日志

### 错误码



1. 错误码为字符串类型，共 5 位，分成两个部分：错误产生来源+四位数字编号
2. 编号不与公司业务架构，更不与组织架构挂钩，以先到先得的原则在统一平台上进行， 审批生效，编号即被永久固定
3. 错误码使用者避免随意定义新的错误码



------

### 异常处理



1. Java 类库中定义的可以通过预检查方式规避的 RuntimeException 异常不应该通过 catch 的方式来处理
2. 异常捕获后不要用来做流程控制，条件控制
3. 捕获异常是为了处理它，不要捕获了却什么都不处理而抛弃之，如果不想处理它，请 将该异常抛给它的调用者。最外层的业务使用者，必须处理异常，将其转化为用户可以理解的内容
4. 事务场景中，抛出异常被 catch 后，如果需要回滚，一定要注意手动回滚事务



------

### 日志规约



1. 在日志输出时，字符串变量之间的拼接使用占位符的方式
2. 生产环境禁止直接使用 System.out 或System.err 输出日志或使用 e.printStackTrace()打印异常堆栈
3. 常信息应该包括两类信息：案发现场信息和异常堆栈信息。如果不处理，那么通过 关键字 throws 往上抛出
4. 日志打印时禁止直接用 JSON工具将对象转换成 String



------

## 单元测试



1. 好的单元测试必须遵守 AIR 原则
2. 单元测试应该是全自动执行的，并且非交互式的。测试用例通常是被定期执行的，执 行过程必须完全自动化才有意义。输出结果需要人工检查的测试不是一个好的单元测试。单元 测试中不准使用 System.out 来进行人肉验证，必须使用 assert 来验证
3. 单元测试是可以重复执行的，不能受到外界环境的影响
4. 对于单元测试，要保证测试粒度足够小，有助于精确定位问题。单测粒度至多是类级别，一般是方法级别
5. 单元测试的基本目标：语句覆盖率达到 70%；核心模块的语句覆盖率和分支覆盖率都 要达到 100%
6. 和数据库相关的单元测试，可以设定自动回滚机制，不给数据库造成脏数据。或者对单元测试产生的数据有明确的前后缀标识



------

## MySQL 数据库

### 建表规约



1. 表达是与否概念的字段，必须使用 is_xxx 的方式命名，数据类型是 unsigned tinyint
2. 主键索引名为 pk_字段名；唯一索引名为 uk_字段名；普通索引名则为 idx_字段名
3. 小数类型为 decimal，禁止使用 float 和 double
4. varchar 是可变长字符串，不预先分配存储空间，长度不要超过 5000，如果存储长度大于此值，定义字段类型为 text，独立出来一张表，用主键来对应，避免影响其它字段索引效率
5. 单表行数超过 500 万行或者单表容量超过 2GB，才推荐进行分库分表



------

### 索引规约



1. 业务上具有唯一特性的字段，即使是组合字段，也必须建成唯一索引
2. 超过三个表禁止 join。需要 join 的字段，数据类型保持绝对一致；多表关联查询时， 保证被关联的字段需要有索引
3. 页面搜索严禁左模糊或者全模糊，如果需要请走搜索引擎来解决
4. 利用延迟关联或者子查询优化超多分页场景
5. SQL 性能优化的目标：至少要达到 range 级别，要求是 ref 级别，如果可以是 consts 最好
6. 建组合索引的时候，区分度最高的在最左边



------

### SQL 语句



1. 不要使用 count(列名)或 count(常量) 来替代 count(*)，count()是 SQL92 定义的标 准统计行数的语法，跟数据库无关，跟 NULL 和非 NULL 无关
2. 当某一列的值全是 NULL 时，count(col) 的返回结果为 0，但 sum(col) 的返回结果为 NULL，因此使用 sum() 时需注意NPE 问题
3. 使用 ISNULL() 来判断是否为 NULL 值
4. 代码中写分页查询逻辑时，若 count 为 0 应直接返回，避免执行后面的分页语句
5. 不得使用外键与级联，一切外键概念必须在应用层解决
6. 禁止使用存储过程，存储过程难以调试和扩展，更没有移植性
7. 数据订正（特别是删除或修改记录操作）时，要先 select，避免出现误删除，确认无 误才能执行更新语句
8. 对于数据库中表记录的查询和变更，只要涉及多个表，都需要在列名前加表的别名（或 表名）进行限定



------

### ORM映射



1. 在表查询中，一律不要使用 * 作为查询的字段列表，需要哪些字段必须明确写明
2. POJO 类的布尔属性不能加 is，而数据库字段必须加 is_，要求在 resultMap 中进行 字段与属性之间的映射
3. 不允许直接拿 HashMap 与 Hashtable 作为查询结果集的输出
4. 更新数据表记录时，必须同时更新记录对应的 update_time 字段值为当前时间
5. @Transactional 事务不要滥用。事务会影响数据库的QPS，另外使用事务的地方需 要考虑各方面的回滚方案，包括缓存回滚、搜索引擎回滚、消息补偿、统计修正等





------

## 工程结构

### 二方库依赖



1. 二方库里可以定义枚举类型，参数可以使用枚举类型，但是接口返回值不允许使用枚 举类型或者包含枚举类型的 POJO 对象
2. 所有 pom 文件中的依赖声明放在 dependencies 语句块中，所有版本仲裁放在 dependencyManagement 语句块中



------

### 服务器



1. 高并发服务器建议调小 TCP 协议的 time_wait 超时时间
2. 调大服务器所支持的最大文件句柄数（File Descriptor，简写为 fd）
3. 给 JVM 环境参数设置 -XX:+HeapDumpOnOutOfMemoryError 参数，让 JVM 碰到 OOM 场景时输出 dump 信息
4. 在线上生产环境，JVM 的 Xms 和 Xmx 设置一样大小的内存容量，避免在 GC 后调整 堆大小带来的压力



------

## 设计规约



1. 谨慎使用继承的方式来进行扩展，优先使用聚合/组合的方式来实现
2. 系统设计阶段，根据依赖倒置原则，尽量依赖抽象类与接口，有利于扩展与维护
3. 系统设计阶段，共性业务或公共行为抽取出来公共模块、公共配置、公共类、公共方法等，在系统中不出现重复代码的情况
4. 代码即文档的观点是错误的，清晰的代码只是文档的某个片断，而不是全部
